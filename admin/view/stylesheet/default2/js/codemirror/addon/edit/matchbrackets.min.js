!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){function t(e,t,n,i){var o=e.getLineHandle(t.line),s=t.ch-1,c=s>=0&&a[o.text.charAt(s)]||a[o.text.charAt(++s)];if(!c)return null;var u=">"==c.charAt(1)?1:-1;if(n&&u>0!=(s==t.ch))return null;var f=e.getTokenTypeAt(l(t.line,s+1)),h=r(e,l(t.line,s+(u>0?1:0)),u,f||null,i);return null==h?null:{from:l(t.line,s),to:h&&h.pos,match:h&&h.ch==c.charAt(0),forward:u>0}}function r(e,t,r,n,i){for(var o=i&&i.maxScanLineLength||1e4,s=i&&i.maxScanLines||1e3,c=[],u=i&&i.bracketRegex?i.bracketRegex:/[(){}[\]]/,f=r>0?Math.min(t.line+s,e.lastLine()+1):Math.max(e.firstLine()-1,t.line-s),h=t.line;h!=f;h+=r){var d=e.getLine(h);if(d){var p=r>0?0:d.length-1,g=r>0?d.length:-1;if(!(d.length>o))for(h==t.line&&(p=t.ch-(0>r?1:0));p!=g;p+=r){var m=d.charAt(p);if(u.test(m)&&(void 0===n||e.getTokenTypeAt(l(h,p+1))==n)){var v=a[m];if(">"==v.charAt(1)==r>0)c.push(m);else{if(!c.length)return{pos:l(h,p),ch:m};c.pop()}}}}}return h-r==(r>0?e.lastLine():e.firstLine())?!1:null}function n(e,r,n){for(var i=e.state.matchBrackets.maxHighlightLineLength||1e3,a=[],s=e.listSelections(),c=0;c<s.length;c++){var u=s[c].empty()&&t(e,s[c].head,!1,n);if(u&&e.getLine(u.from.line).length<=i){var f=u.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket";a.push(e.markText(u.from,l(u.from.line,u.from.ch+1),{className:f})),u.to&&e.getLine(u.to.line).length<=i&&a.push(e.markText(u.to,l(u.to.line,u.to.ch+1),{className:f}))}}if(a.length){o&&e.state.focused&&e.focus();var h=function(){e.operation(function(){for(var e=0;e<a.length;e++)a[e].clear()})};if(!r)return h;setTimeout(h,800)}}function i(e){e.operation(function(){s&&(s(),s=null),s=n(e,!1,e.state.matchBrackets)})}var o=/MSIE \d/.test(navigator.userAgent)&&(null==document.documentMode||document.documentMode<8),l=e.Pos,a={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<"},s=null;e.defineOption("matchBrackets",!1,function(t,r,n){n&&n!=e.Init&&t.off("cursorActivity",i),r&&(t.state.matchBrackets="object"==typeof r?r:{},t.on("cursorActivity",i))}),e.defineExtension("matchBrackets",function(){n(this,!0)}),e.defineExtension("findMatchingBracket",function(e,r,n){return t(this,e,r,n)}),e.defineExtension("scanForBracket",function(e,t,n,i){return r(this,e,t,n,i)})});