!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){function t(e,t){return"pairs"==t&&"string"==typeof e?e:"object"==typeof e&&null!=e[t]?e[t]:f[t]}function r(e){return function(t){return a(t,e)}}function n(e){var t=e.state.closeBrackets;if(!t)return null;var r=e.getModeAt(e.getCursor());return r.closeBrackets||t}function i(r){var i=n(r);if(!i||r.getOption("disableInput"))return e.Pass;for(var o=t(i,"pairs"),l=r.listSelections(),a=0;a<l.length;a++){if(!l[a].empty())return e.Pass;var s=u(r,l[a].head);if(!s||0!=o.indexOf(s)%2)return e.Pass}for(var a=l.length-1;a>=0;a--){var c=l[a].head;r.replaceRange("",h(c.line,c.ch-1),h(c.line,c.ch+1),"+delete")}}function o(r){var i=n(r),o=i&&t(i,"explode");if(!o||r.getOption("disableInput"))return e.Pass;for(var l=r.listSelections(),a=0;a<l.length;a++){if(!l[a].empty())return e.Pass;var s=u(r,l[a].head);if(!s||0!=o.indexOf(s)%2)return e.Pass}r.operation(function(){r.replaceSelection("\n\n",null),r.execCommand("goCharLeft"),l=r.listSelections();for(var e=0;e<l.length;e++){var t=l[e].head.line;r.indentLine(t,null,!0),r.indentLine(t+1,null,!0)}})}function l(t){var r=e.cmpPos(t.anchor,t.head)>0;return{anchor:new h(t.anchor.line,t.anchor.ch+(r?-1:1)),head:new h(t.head.line,t.head.ch+(r?1:-1))}}function a(r,i){var o=n(r);if(!o||r.getOption("disableInput"))return e.Pass;var a=t(o,"pairs"),u=a.indexOf(i);if(-1==u)return e.Pass;for(var f,d,p=t(o,"triples"),g=a.charAt(u+1)==i,m=r.listSelections(),v=0==u%2,y=0;y<m.length;y++){var b,w=m[y],x=w.head,d=r.getRange(x,h(x.line,x.ch+1));if(v&&!w.empty())b="surround";else if(!g&&v||d!=i)if(g&&x.ch>1&&p.indexOf(i)>=0&&r.getRange(h(x.line,x.ch-2),x)==i+i&&(x.ch<=2||r.getRange(h(x.line,x.ch-3),h(x.line,x.ch-2))!=i))b="addFour";else if(g){if(e.isWordChar(d)||!c(r,x,i))return e.Pass;b="both"}else{if(!v||r.getLine(x.line).length!=x.ch&&!s(d,a)&&!/\s/.test(d))return e.Pass;b="both"}else b=p.indexOf(i)>=0&&r.getRange(x,h(x.line,x.ch+3))==i+i+i?"skipThree":"skip";if(f){if(f!=b)return e.Pass}else f=b}var C=u%2?a.charAt(u-1):i,S=u%2?i:a.charAt(u+1);r.operation(function(){if("skip"==f)r.execCommand("goCharRight");else if("skipThree"==f)for(var e=0;3>e;e++)r.execCommand("goCharRight");else if("surround"==f){for(var t=r.getSelections(),e=0;e<t.length;e++)t[e]=C+t[e]+S;r.replaceSelections(t,"around"),t=r.listSelections().slice();for(var e=0;e<t.length;e++)t[e]=l(t[e]);r.setSelections(t)}else"both"==f?(r.replaceSelection(C+S,null),r.triggerElectric(C+S),r.execCommand("goCharLeft")):"addFour"==f&&(r.replaceSelection(C+C+C+C,"before"),r.execCommand("goCharRight"))})}function s(e,t){var r=t.lastIndexOf(e);return r>-1&&1==r%2}function u(e,t){var r=e.getRange(h(t.line,t.ch-1),h(t.line,t.ch+1));return 2==r.length?r:null}function c(t,r,n){var i=t.getLine(r.line),o=t.getTokenAt(r);if(/\bstring2?\b/.test(o.type))return!1;var l=new e.StringStream(i.slice(0,r.ch)+n+i.slice(r.ch),4);for(l.pos=l.start=o.start;;){var a=t.getMode().token(l,o.state);if(l.pos>=r.ch+1)return/\bstring2?\b/.test(a);l.start=l.pos}}var f={pairs:"()[]{}''\"\"",triples:"",explode:"[]{}"},h=e.Pos;e.defineOption("autoCloseBrackets",!1,function(t,r,n){n&&n!=e.Init&&(t.removeKeyMap(p),t.state.closeBrackets=null),r&&(t.state.closeBrackets=r,t.addKeyMap(p))});for(var d=f.pairs+"`",p={Backspace:i,Enter:o},g=0;g<d.length;g++)p["'"+d.charAt(g)+"'"]=r(d.charAt(g))});